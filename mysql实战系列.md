---
typora-root-url: D:\mynote\assets
---

# mysql实战系列

## 基础架构

> server层：连接器、查询缓存、分析器、优化器、执行器
>
> 存储引擎层：负责数据的存储和提取，架构是插件式的支持InnoDB、MyISAM、Memory等多个存储引擎

![1542604390736](/1542604390736.png)

1. 连接器：负责和客户端建立连接、获取权限、维持和管理连接

   > 利用show processlist查看连接状态
   >
   > 客户端空闲时间太长，连接器会自动断开，由时间参数wait_timeout控制，默认值是8小时
   >
   > 在使用中尽量多的使用长连接，但是全部使用长连接后，会导致mysql占用内存上涨很快，因为mysql在执行过程中临时使用的内存是管理在连接对象里面的。这些资源只有在连接断开是才能被释放，此时可以考虑以下两种解决方案：
   >
   > * 定期断开长连接。使用一段时间，或者程序里面判断执行过一个占用内存的大查询后，断开连接，之后要查询再重连。
   > * 如果用的是mysql5.7或者更新的版本，可以在每次执行一个比较大的操作后，通过执行mysql_reset_connection来重新初始化连接资源。这个过程不需要重连和重新做权限验证，但是会将连接恢复到刚刚创建完成是的状态

2. 查询缓存：mysql拿到查询后，会先到查询缓存看看，之前是不是执行过这条语句。

   > 之前执行过的查询语句会以：key-value的形式存储在缓存中，key是查询语句，value是查询结果