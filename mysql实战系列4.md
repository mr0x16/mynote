# MySQL实战系列4

## 全局锁和表锁

设计初衷：处理并发问题

1. 全局锁

全局锁就是对整个数据库实例加锁，那么如何加全局锁呢

```mysql
Flush tables with read lock(FTWRL)
```

当需要让这个库处于只读状态的时候，可以使用这个命令

此时，其他线程的一下语句会被阻塞：

* 数据更新语句(数据的增删改)
* 数据定义语句(包括建表、修改数据库结构等)
* 更新类事务的提交语句

此时，整个数据库完全处于只读状态

**全局锁典型的应用场景是做全库逻辑备份**

2. 表级锁：

**表级锁有两种，一种是表锁，一种是元数据锁(metadata lock, MDL)。**

*表锁* 的语法是`lock tables ... read/write`，可以使用unlock tables主动释放，也可以在客户端断开的时候自动释放。**lock tables除了会限制其他线程的读写外，还会限制本线程接下来的操作对象**

*元数据锁* (MDL)不需要显示使用，在访问一个表的时候会自动加上(MySQL5.5版本中引入)。作用是保证读写一致性。

* 当对一个表做增删改查操作的时候，加MDL读锁；
* 当对表结构做变更时，加MDL写锁；

> 读锁之间不互斥，因此可以有多个线程同时对一张表增删改查；
>
> 读写锁之间、写锁之间互斥，在做表结构变更操作时保证安全性。

